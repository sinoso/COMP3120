ksh@ksh-VirtualBox:~/COMP3120/testing$ ./2_2_1
without lock
count=1000000 time = 2095.000000 threads = 1
count=1000000 time = 36.000000 threads = 2
count=1000000 time = 41.000000 threads = 4
count=1000000 time = 109.000000 threads = 8
count=1000000 time = 191.000000 threads = 16
count=1000000 time = 497.000000 threads = 32
count=1000000 time = 868.000000 threads = 64
count=1000000 time = 2215.000000 threads = 128

ksh@ksh-VirtualBox:~/COMP3120/testing$ ./2_2_2
with lock
count=1000000 time = 39168.000000 threads = 1
count=1000000 time = 61.000000 threads = 2
count=1000000 time = 46.000000 threads = 4
count=1000000 time = 128.000000 threads = 8
count=1000000 time = 218.000000 threads = 16
count=1000000 time = 319.000000 threads = 32
count=1000000 time = 2214.000000 threads = 64
count=1000000 time = 3614.000000 threads = 128


code
#include <pthread.h>
#include <stdio.h>
#include <unistd.h>
#include <sys/time.h>
#include <stdlib.h>
/* pthread_mutex_t mutex; *///for lock
int count = 0;
void *t_function()
{
	while(count<1000000)
	count++;
}

/*
void *t_function() //for lock
{
	while(count<1000000)
	{
	pthread_mutex_lock(&mutex);
	count++;
	pthread_mutex_unlock(&mutex);
	};
}
*/


int main()
{
	int i;
	pthread_t p_thread;
	int thr_id;
    	struct timeval start,end;
	double diffrent;
	int thread_multi;

	printf("without lock\n");
	/*printf("with lock\n");*/// for lock
	for(thread_multi=1;thread_multi<=128;)
	{
		gettimeofday(&start, NULL);//start
		for(i=0;i<thread_multi;i++)
		{
			thr_id = pthread_create(&p_thread, NULL, t_function, NULL);
			if (thr_id < 0)
			{
				perror("thread create error : ");
				exit(0);
			}
		}
		for(i=0;i<thread_multi;i++)
		{
			pthread_join(p_thread,NULL);
		}
		gettimeofday(&end, NULL);
		diffrent = end.tv_sec *1000000.0 + end.tv_usec- start.tv_sec*1000000.0 - start.tv_usec;
		printf("count=%d time = %f threads = %d\n",count,diffrent, thread_multi);//end
		thread_multi = thread_multi+thread_multi;
	};
	return 0;
}
